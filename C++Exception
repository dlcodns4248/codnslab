#include // std::abs 사용

using namespace std;

// T 타입의 곱셈 오버플로를 안전하게 검사하는 함수
template
T checked_multiply(T a, T b) {
// 0이 아닌 경우에만 오버플로 검사 수행
if (a != 0 && b != 0) {
if (std::abs(a) > std::numeric_limits::max() / std::abs(b)) {
// 오버플로 또는 언더플로 발생 시 예외 throw
throw overflow_error("곱셈 결과 오버플로 발생.");
}
}
return a * b;
}

int main() {
int num1, num2, num3;

cout << "세 개의 정수를 입력하세요 (음수는 허용하지 않음):" << endl;

try {
    // 입력
    cout << "첫 번째 정수: ";
    if (!(cin >> num1)) throw runtime_error("잘못된 입력 형식입니다.");
    cout << "두 번째 정수: ";
    if (!(cin >> num2)) throw runtime_error("잘못된 입력 형식입니다.");
    cout << "세 번째 정수: ";
    if (!(cin >> num3)) throw runtime_error("잘못된 입력 형식입니다.");
        
    // 1. 음수 입력 체크
    if (num1 < 0 || num2 < 0 || num3 < 0) {
        // std::out_of_range 예외 사용
        throw out_of_range("음수 입력 오류: 입력은 0 또는 양의 정수여야 합니다.");
    }
    
    // 2. 곱셈 및 오버플로 체크 (long long으로 확장하여 계산)
    long long temp_product = checked_multiply((long long)num1, (long long)num2);
    long long final_product = checked_multiply(temp_product, (long long)num3);

    // final_product가 int 범위를 초과하는지 최종 확인 (출력을 int로 가정할 경우)
    if (final_product > numeric_limits<int>::max()) {
         throw overflow_error("최종 곱셈 결과가 int 범위를 초과합니다.");
    }

    cout << "세 정수의 곱: " << (int)final_product << endl;

} catch (const out_of_range& e) {
    cerr << "오류: " << e.what() << endl;
    cerr << "프로그램을 종료합니다." << endl;
    return 1;
} catch (const overflow_error& e) {
    cerr << "오류: " << e.what() << endl;
    cerr << "프로그램을 종료합니다." << endl;
    return 1;
} catch (const runtime_error& e) {
    cerr << "오류: " << e.what() << endl;
    cerr << "프로그램을 종료합니다." << endl;
    return 1;
} catch (...) {
    cerr << "알 수 없는 오류가 발생했습니다." << endl;
    cerr << "프로그램을 종료합니다." << endl;
    return 1;
}

return 0;
}
